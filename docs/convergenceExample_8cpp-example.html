<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.11"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>Marian: convergenceExample.cpp</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="marian.css" rel="stylesheet" type="text/css"/>
<link href="bootstrap_custom.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/3.3.1/flatly/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">Marian 0.9</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main</span></a></li>
      <li><a href="pages.html"><span>Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">convergenceExample.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Example shows how model converges when different schemes and grids are chosen. We tested following settings:</p><ul>
<li>Explicit scheme with uniform grid</li>
<li>Implicit scheme with uniform grid</li>
<li>Crank-Nicolson scheme with uniform grid</li>
<li>Crank-Nicolson scheme with non-uniform grid with low clustering</li>
<li>Crank-Nicolson scheme with uniform grid with high clustering</li>
</ul>
<p>We see that non-uniform grid converge faster for small number of spatial steps. For larger number of spatial steps the differences between schemes are small. </p><div class="image">
<img src="convergence_spatial.png" alt="convergence_spatial.png"/>
</div>
<p>In case of number of time steps, we see advantage of Crank Nicolson scheme, for which even the small number of time steps ensures convergence. We see that solution differences from the analytical price. The difference is cause by using small number of spatial steps. Using larger number of spatial steps would cause the instability of explicit scheme for small number of time steps.</p>
<div class="image">
<img src="convergence_time.png" alt="convergence_time.png"/>
</div>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;marian.hpp&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacemarian.html">marian</a>;</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">  </div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// Preparing building blocks of PDE solver</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <a name="_a0"></a><a class="code" href="classmarian_1_1LUSolver.html">LUSolver</a> solver;</div><div class="line">  <a name="_a1"></a><a class="code" href="classmarian_1_1UniformGridBuilder.html">UniformGridBuilder</a> ugrid;</div><div class="line">  <a name="_a2"></a><a class="code" href="classmarian_1_1HSineGridBuilder.html">HSineGridBuilder</a> nugrid1(0.75);</div><div class="line">  <a class="code" href="classmarian_1_1HSineGridBuilder.html">HSineGridBuilder</a> nugrid2(0.25);</div><div class="line">  <a name="_a3"></a><a class="code" href="classmarian_1_1SpotRelatedRange.html">SpotRelatedRange</a> range_setter(0.2, 3.0);</div><div class="line">  </div><div class="line">  <a name="_a4"></a><a class="code" href="classmarian_1_1ExplicitScheme.html">ExplicitScheme</a> scheme_ex;</div><div class="line">  <a name="_a5"></a><a class="code" href="classmarian_1_1ImplicitScheme.html">ImplicitScheme</a> scheme_im;</div><div class="line">  <a name="_a6"></a><a class="code" href="classmarian_1_1CrankNicolsonScheme.html">CrankNicolsonScheme</a> scheme_cn;</div><div class="line"></div><div class="line">  </div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// Constructing option and market</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="keywordtype">double</span> strike = 1.0;</div><div class="line">  <span class="keywordtype">double</span> tenor = 1.0;</div><div class="line">  <a name="_a7"></a><a class="code" href="classmarian_1_1EuroOpt.html">EuroOpt</a> option(strike, tenor, <a name="a8"></a><a class="code" href="group__utils.html#gga3b2bdf5bdfe149f1cdaf63b03b9f4c23aca3547acb9162b49fb4a6594ed9b3030">OptionType::CALL</a>);</div><div class="line"></div><div class="line">  <a name="_a9"></a><a class="code" href="structmarian_1_1Market.html">Market</a> market;</div><div class="line">  market.<a name="a10"></a><a class="code" href="structmarian_1_1Market.html#a28ade4924ed99ec5bc38ecd3622dfc9c">spot</a> = 1.05;</div><div class="line">  market.<a name="a11"></a><a class="code" href="structmarian_1_1Market.html#a148ced1e4f807687020979bbc5fa468a">vol</a> = 0.25;</div><div class="line">  market.<a name="a12"></a><a class="code" href="structmarian_1_1Market.html#a16deb96acc8acb1f5f2872035ae67475">r</a> = 0.02;</div><div class="line"></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// We will use analytical solution as benchmark</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="keywordtype">double</span> analytic_price = <a name="a13"></a><a class="code" href="group__fin.html#ga21b694a8d10bfbb798fa7a3921e4a33d">BSprice</a>(market, option);</div><div class="line"></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// Preparing pricers and performing test</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <a name="_a14"></a><a class="code" href="classmarian_1_1FDMPricer.html">FDMPricer</a> pricer1(scheme_ex, solver, ugrid,   ugrid, range_setter);</div><div class="line">  <a class="code" href="classmarian_1_1FDMPricer.html">FDMPricer</a> pricer2(scheme_im, solver, ugrid,   ugrid, range_setter);</div><div class="line">  <a class="code" href="classmarian_1_1FDMPricer.html">FDMPricer</a> pricer3(scheme_cn, solver, ugrid,   ugrid, range_setter);</div><div class="line">  <a class="code" href="classmarian_1_1FDMPricer.html">FDMPricer</a> pricer4(scheme_cn, solver, nugrid1, ugrid, range_setter);</div><div class="line">  <a class="code" href="classmarian_1_1FDMPricer.html">FDMPricer</a> pricer5(scheme_cn, solver, nugrid2, ugrid, range_setter);</div><div class="line">  </div><div class="line">  <a name="_a15"></a><a class="code" href="classmarian_1_1DataFrame.html">DataFrame</a> results_spatial;</div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 40; ns &lt;= 200; ns += 10) {</div><div class="line">    </div><div class="line">    <span class="keywordtype">double</span> fdm_price1 = pricer1.<a name="a16"></a><a class="code" href="classmarian_1_1FDMPricer.html#a499bd752a6574e5de68703b4e5a40207">price</a>(market, option, ns, 350);</div><div class="line">    <span class="keywordtype">double</span> fdm_price2 = pricer2.<a class="code" href="classmarian_1_1FDMPricer.html#a499bd752a6574e5de68703b4e5a40207">price</a>(market, option, ns, 350);</div><div class="line">    <span class="keywordtype">double</span> fdm_price3 = pricer3.<a class="code" href="classmarian_1_1FDMPricer.html#a499bd752a6574e5de68703b4e5a40207">price</a>(market, option, ns, 350);</div><div class="line">    <span class="keywordtype">double</span> fdm_price4 = pricer4.<a class="code" href="classmarian_1_1FDMPricer.html#a499bd752a6574e5de68703b4e5a40207">price</a>(market, option, ns, 350);</div><div class="line">    <span class="keywordtype">double</span> fdm_price5 = pricer5.<a class="code" href="classmarian_1_1FDMPricer.html#a499bd752a6574e5de68703b4e5a40207">price</a>(market, option, ns, 350);</div><div class="line">    </div><div class="line">    <a name="_a17"></a><a class="code" href="classmarian_1_1DataEntryClerk.html">DataEntryClerk</a> input;     </div><div class="line">    input.<a name="a18"></a><a class="code" href="classmarian_1_1DataEntryClerk.html#a462ca9aa0271caa9ad13242d9bacdc08">add</a>(<span class="stringliteral">&quot;NS&quot;</span>, ns);</div><div class="line">    input.<a class="code" href="classmarian_1_1DataEntryClerk.html#a462ca9aa0271caa9ad13242d9bacdc08">add</a>(<span class="stringliteral">&quot;Analytic&quot;</span>, analytic_price);  </div><div class="line">    input.<a class="code" href="classmarian_1_1DataEntryClerk.html#a462ca9aa0271caa9ad13242d9bacdc08">add</a>(<span class="stringliteral">&quot;Explicit_uniform&quot;</span>, fdm_price1);</div><div class="line">    input.<a class="code" href="classmarian_1_1DataEntryClerk.html#a462ca9aa0271caa9ad13242d9bacdc08">add</a>(<span class="stringliteral">&quot;Implicit_uniform&quot;</span>, fdm_price2);</div><div class="line">    input.<a class="code" href="classmarian_1_1DataEntryClerk.html#a462ca9aa0271caa9ad13242d9bacdc08">add</a>(<span class="stringliteral">&quot;CrankNicolson_uniform&quot;</span>, fdm_price3);</div><div class="line">    input.<a class="code" href="classmarian_1_1DataEntryClerk.html#a462ca9aa0271caa9ad13242d9bacdc08">add</a>(<span class="stringliteral">&quot;CrankNicolson_nonuniform75&quot;</span>, fdm_price4);</div><div class="line">    input.<a class="code" href="classmarian_1_1DataEntryClerk.html#a462ca9aa0271caa9ad13242d9bacdc08">add</a>(<span class="stringliteral">&quot;CrankNicolson_nonuniform25&quot;</span>, fdm_price5);</div><div class="line">    results_spatial.<a name="a19"></a><a class="code" href="classmarian_1_1DataFrame.html#af1c5e051964c28384b5509a9ef6a7f57">append</a>(input);</div><div class="line">  }</div><div class="line">  results_spatial.<a name="a20"></a><a class="code" href="classmarian_1_1DataFrame.html#a45b5c309b0959c15b2424e152f76a4c0">printToCsv</a>(<span class="stringliteral">&quot;convergenceExample1&quot;</span>);</div><div class="line"></div><div class="line">    </div><div class="line">  <a class="code" href="classmarian_1_1DataFrame.html">DataFrame</a> results_time;</div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nt = 30; nt &lt;= 300; nt += 10) {</div><div class="line">    </div><div class="line">    <span class="keywordtype">double</span> fdm_price1 = pricer1.<a class="code" href="classmarian_1_1FDMPricer.html#a499bd752a6574e5de68703b4e5a40207">price</a>(market, option, 50, nt);</div><div class="line">    <span class="keywordtype">double</span> fdm_price2 = pricer2.<a class="code" href="classmarian_1_1FDMPricer.html#a499bd752a6574e5de68703b4e5a40207">price</a>(market, option, 50, nt);</div><div class="line">    <span class="keywordtype">double</span> fdm_price3 = pricer3.<a class="code" href="classmarian_1_1FDMPricer.html#a499bd752a6574e5de68703b4e5a40207">price</a>(market, option, 50, nt);</div><div class="line">    <span class="keywordtype">double</span> fdm_price4 = pricer4.<a class="code" href="classmarian_1_1FDMPricer.html#a499bd752a6574e5de68703b4e5a40207">price</a>(market, option, 50, nt);</div><div class="line">    <span class="keywordtype">double</span> fdm_price5 = pricer5.<a class="code" href="classmarian_1_1FDMPricer.html#a499bd752a6574e5de68703b4e5a40207">price</a>(market, option, 50, nt);</div><div class="line">    </div><div class="line">    <a class="code" href="classmarian_1_1DataEntryClerk.html">DataEntryClerk</a> input;     </div><div class="line">    input.<a class="code" href="classmarian_1_1DataEntryClerk.html#a462ca9aa0271caa9ad13242d9bacdc08">add</a>(<span class="stringliteral">&quot;NT&quot;</span>, nt);</div><div class="line">    input.<a class="code" href="classmarian_1_1DataEntryClerk.html#a462ca9aa0271caa9ad13242d9bacdc08">add</a>(<span class="stringliteral">&quot;Analytic&quot;</span>, analytic_price);  </div><div class="line">    input.<a class="code" href="classmarian_1_1DataEntryClerk.html#a462ca9aa0271caa9ad13242d9bacdc08">add</a>(<span class="stringliteral">&quot;Explicit_uniform&quot;</span>, fdm_price1);</div><div class="line">    input.<a class="code" href="classmarian_1_1DataEntryClerk.html#a462ca9aa0271caa9ad13242d9bacdc08">add</a>(<span class="stringliteral">&quot;Implicit_uniform&quot;</span>, fdm_price2);</div><div class="line">    input.<a class="code" href="classmarian_1_1DataEntryClerk.html#a462ca9aa0271caa9ad13242d9bacdc08">add</a>(<span class="stringliteral">&quot;CrankNicolson_uniform&quot;</span>, fdm_price3);</div><div class="line">    input.<a class="code" href="classmarian_1_1DataEntryClerk.html#a462ca9aa0271caa9ad13242d9bacdc08">add</a>(<span class="stringliteral">&quot;CrankNicolson_nonuniform75&quot;</span>, fdm_price4);</div><div class="line">    input.<a class="code" href="classmarian_1_1DataEntryClerk.html#a462ca9aa0271caa9ad13242d9bacdc08">add</a>(<span class="stringliteral">&quot;CrankNicolson_nonuniform25&quot;</span>, fdm_price5);</div><div class="line">    results_time.<a class="code" href="classmarian_1_1DataFrame.html#af1c5e051964c28384b5509a9ef6a7f57">append</a>(input);</div><div class="line">  }</div><div class="line">  results_time.<a class="code" href="classmarian_1_1DataFrame.html#a45b5c309b0959c15b2424e152f76a4c0">printToCsv</a>(<span class="stringliteral">&quot;convergenceExample2&quot;</span>);</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
